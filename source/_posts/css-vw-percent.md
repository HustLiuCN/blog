---
title: VW 的是与非
date: 2021-03-26 17:53:07
tags: CSS, 前端
---

# 一个问题

最近项目中遇到一个问题，页面出现了莫名其妙的横向滚动条，同一设备稳定复现，不同设备无法稳定复现，如图:

![滚动条bug](/imgs/bug.png)

最终发现是与基础架构引入的一个全局样式 `width: 100vw` 有关，在定位、解决问题的过程中也顺道学习了相关的知识，把其中一篇比较有指导意义的文章翻译出来以供大家参考。文章比较久远，但其中涉及到的基础概念没有过时。

**译文如下:**

<!-- more -->

# Viewport (可视区域) 单位 vs 百分比单位

<small>*译者注: 由于 `viewport` 是一个前端常见概念，故后文将不对此进行翻译。*</small>

## Viewport 单位

Viewport 单位是**相对单位**，也就是说它们并不具备一个客观、绝对的尺寸，而是相对于整个 viewport 的尺寸确定的。以下是四个相对于 viewport 的尺寸单位:

| 单位 | 描述 |
| ---- | ---- |
| vw | viewport 宽度的 1/100，即整个视图区域宽为 `100vw` |
| vh | viewport 高度的 1/100，即整个视图区域高为 `100vh` |
| vmin | viewport **高**与**宽**两者中**最小的值**，比如 300 x 400 的视图区域，vmin = 300 |
| vmax | viewport **高**与**宽**两者中**最大的值** |

后文会着重关注于 `vw` 和 `vh` 这两个更为常用的单位。

在许多场景中，viewport 单位（即 `vw` `vh`）与**百分比单位**在功能与使用上上有许多重叠，当然，他们也都有着各自很明显的优劣势。总而言之的话:

> 在处理**宽度**尺寸的时候，百分比单位（`%`）更为合适，而处理**高度**则 `vh` 表现的更为卓越一些。

## 全宽元素: % 优于 vw

<small>*译者: **全宽元素**可能翻译的不够准确，以我们朴素的视角去理解，就是那些要占满整个视图区域宽度的元素。*</small>

正如之前所提到的，`vw` 是基于 viewport 的宽度来确定自己的尺寸。然而，浏览器在计算 viewport 宽度时是以浏览器窗口的宽度，**也就是说会包含滚动条所占用的空间**。

![](/imgs/viewportvsbody.jpeg)

如上图，当页面中出现滚动条的时候，viewport 的宽度显然就会大于 html element 的宽度。

> Viewport > html > body

因此，当你设置了一个元素的宽为 `100vw`，该元素很有可能会延伸至 `html` 和 `body` 的外侧。在下面的例子当中，我们给 `html` 元素设置了红色的边框，而 `section` 则设置了宽为 `100vw` 以及背景色:

![](/imgs/viewportvsbody2.png)

可见，由于这种细微差别的存在，当需要设置一个元素为整个页面宽时，使用**百分比**单位会是一个更好的选择。

## 全高元素: vh 优于 %

另一方面，当需要设置一个元素为整个页面高时，`vh` 会是一个更好的选择

**由于一个设置了百分比单位的元素，其尺寸是基于父元素而确定的**，只有当一个元素的**父元素**是填充满整个屏幕的时候，我们才可以将**这个元素**的高度设置为整个屏幕高。通常来说，这样的场景我们会通过将这个元素用 `fixed` 来定位，从而使得 `html` 成为其父元素，又或者通过其他 hack 手法来实现。

但是通过 `vh`，解决问题变得轻而易举:

```css
.example {
    height: 100vh;
}
```

上面的代码中，无论 `.example` 元素是处于怎样的嵌套结构中，它始终可以相对于 viewport 也就是视图区域来决定自己的尺寸。**滚动条的问题也不再会是一个问题，因为绝大部分的页面通常不会展示出水平方向的滚动条**
<small>(*译者: 但是同纵向滚动条造成的宽度问题一样，滚动条存在导致的高度差异依然存在，只是原文作者认为这不会是一个大的、常见的问题*)。</small>

## 案例

<small>*译者: 原文中罗列的几个应用案例在现在看来已经很基础了，就不做过多赘述，只把效果图附上，感兴趣的朋友可以自行思考其实现。*</small>

![](/imgs/demo1.gif)

![](/imgs/demo2.gif)

![](/imgs/demo3.gif)

## 兼容性

<small>*译者: 由于原文发表于 2015 年，其兼容性已不具有参考性，译者下方贴出的是最新 [caniuse](https://caniuse.com/?search=vw) 上的查询结果。*</small>

![](/imgs/caniuse.png)

# 回到问题

回到文章开头提到的问题。结合上面的文章，再对照我们发现的外部引入的一个全局样式:

```css
#root {
    width: 100vw;
    height: 100vh;
    display: flex;
    flex-direction: column;
}
```

基本上已经明确了问题的原因。关于这段**简单的**样式，我有不少槽点，但因为涉及到全平台产品的样式统一，作为一个局部视角，个人的理解难免有偏差，所以不做过多评论。这里仅针对 `width: 100vw` 发表一些自己的看法。

确实，这并不是一个非常常见的问题。所以会有一种声音: 这不算个 bug，如果是 bug，其他应用方也会反馈。

首先，作为一个工作了若干年的准·老同志，我不想重申「bug 不是所有人复现才叫 bug」这个观点<small>(实际上还是重申了)</small>。由于现在 Mac + chrome 几乎成了前端开发的标配，所以许多兼容性问题被大家有意无意的忽略掉了。如果你没见过下面这张图中的场景，那么恭喜你还很年轻:

![](/imgs/scrollbar.png)

因为现代浏览器绝大部分时候滚动条是不会常驻的，即便出现，也不会占用浏览器视图区域的实际空间，所以前文中的 `viewport > html` 的关系也就不一定成立。但看到上图中的滚动条样式，如果还不认为这是一个**可以稳定复现的 bug** 的话，那只能说不够客观了。这种**滚动条常驻 + 占用页面空间的形态**，很可能就存在于客户的某一台 Windows 电脑的某一种国产浏览器上，这样的话我们是否需要去解决呢？

这个时候可能又会有朋友站出来反驳了，为了针对极小部分场景去做修复适配，ROI 太低，得不偿失。这么说也无可厚非，可如果这**极小部分场景**是由于我们自己的开发造成的呢？如果它本身是完全可以规避的呢？

回到前面那段样式，我暂时没有找到一个能够充分说服自己的理由去给根元素设置这样一个带有不确定性的宽度单位，先前的工作经历也很少见过这样的做法。换个角度思考，是否完全可以通过其他方式来实现这个目的，比如:

```css
html, body, #root {
    width: 100%;
}
```

可能对于我这种老派研发来说，简单、高效、易懂的样式编写才是最经济实惠的解决方案。说来也巧，工作七年之久的我从来没有在项目中用过 `vw` 等属性，这当然不是什么值得骄傲的事情，但应该也不算是特别难以启齿的丢人事儿。

# 结语

读过上面的译文以及我个人工作中遇到的一个案例，相信各位看官在之后的开发过程中遇到类似场景，会有一个自己的判断、抉择标准。

很骄傲我们团队的小伙伴都是一群**追求极致**的年轻人，既没有丢下老派开发原教旨主义的我，也能够面对新技术时抱有怀疑和探究的精神。

同时，**[神策数据](https://www.sensorsdata.cn)作为一家行业领先的大数据分析和营销科技服务商**，一直都是秉持着客户第一的价值观。因而，遇到类似的问题也总是遵循解决客户为第一要素的原则，以解决问题作为核心诉求的行事风格。这才得以产出对这种细小问题仍刨根问底的解决方案。

所以，如果有同样追求的你，也想加入这样优质的团队，欢迎发邮件到 **liupeidong1027@gmail.com**交流，知无不言言无不尽，什么岗位都有。

<small>*[文中翻译原文链接](https://bitsofco.de/viewport-vs-percentage-units/)*</small>
